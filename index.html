<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TermOS LT üåå - Multiverse OS</title>
    <meta name="theme-color" content="#0f0">
    <meta name="description" content="A revolutionary multiverse operating system with AI assistant, gamification, and extensible plugin architecture.">

    <style>
        /* --- CSS VARIABLES & RESET --- */
        :root {
            --bg-color: #050505;
            --term-green: #00ff41;
            --term-dim: #008f11;
            --term-bright: #ccffcc;
            --scanline: rgba(0, 0, 0, 0.5);
            --crt-flicker: rgba(18, 16, 16, 0.1);
            --font-stack: 'Courier New', Courier, monospace;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            scrollbar-width: thin;
            scrollbar-color: var(--term-dim) var(--bg-color);
        }

        body {
            background-color: var(--bg-color);
            color: var(--term-green);
            font-family: var(--font-stack);
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            font-size: 16px;
            -webkit-font-smoothing: none;
        }

        /* --- CRT EFFECTS --- */
        .crt-container {
            position: relative;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        .scanlines {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(
                to bottom,
                rgba(255,255,255,0),
                rgba(255,255,255,0) 50%,
                rgba(0,0,0,0.2) 50%,
                rgba(0,0,0,0.2)
            );
            background-size: 100% 4px;
            pointer-events: none;
            z-index: 10;
        }

        .crt-flicker {
            animation: flicker 0.15s infinite;
            pointer-events: none;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--crt-flicker);
            z-index: 9;
            opacity: 0.1;
        }

        .crt-glow {
            text-shadow: 0 0 5px var(--term-dim), 0 0 10px var(--term-green);
        }

        @keyframes flicker {
            0% { opacity: 0.97; }
            50% { opacity: 1; }
            100% { opacity: 0.98; }
        }

        @keyframes boot-sequence {
            0% { opacity: 0; transform: translateY(20px); }
            100% { opacity: 1; transform: translateY(0); }
        }

        /* --- LAYOUT --- */
        #app {
            display: flex;
            flex-direction: column;
            height: 100%;
            padding: 20px;
            position: relative;
            z-index: 5;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid var(--term-dim);
            padding-bottom: 10px;
            margin-bottom: 10px;
        }

        .brand {
            font-weight: bold;
            font-size: 1.5rem;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .stats-bar {
            display: flex;
            gap: 15px;
            font-size: 0.9rem;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* --- MAIN OUTPUT AREA --- */
        #terminal-output {
            flex: 1;
            overflow-y: auto;
            margin-bottom: 10px;
            padding-right: 10px;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .log-entry {
            line-height: 1.4;
            word-wrap: break-word;
        }

        .log-entry.system { color: var(--term-dim); font-style: italic; }
        .log-entry.user { color: var(--term-bright); }
        .log-entry.ai { color: var(--term-green); }
        .log-entry.error { color: #ff3333; text-shadow: 0 0 5px red; }
        
        .timestamp {
            opacity: 0.5;
            margin-right: 8px;
            font-size: 0.8em;
        }

        .avatar-ascii {
            white-space: pre;
            font-size: 10px;
            line-height: 10px;
            display: inline-block;
            margin-right: 10px;
            vertical-align: middle;
        }

        /* --- INPUT AREA --- */
        #input-area {
            display: flex;
            align-items: center;
            background: rgba(0, 20, 0, 0.8);
            border: 1px solid var(--term-dim);
            padding: 10px;
        }

        .prompt {
            margin-right: 10px;
            font-weight: bold;
        }

        #cmd-input {
            flex: 1;
            background: transparent;
            border: none;
            color: var(--term-green);
            font-family: var(--font-stack);
            font-size: 1.1rem;
            outline: none;
            text-transform: none;
        }

        /* --- MODALS & OVERLAYS --- */
        .modal {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80%;
            max-width: 600px;
            background: #000;
            border: 2px solid var(--term-green);
            padding: 20px;
            z-index: 20;
            display: none;
            box-shadow: 0 0 20px var(--term-dim);
        }

        .modal.active { display: block; }

        .modal-header {
            display: flex;
            justify-content: space-between;
            border-bottom: 1px dashed var(--term-dim);
            padding-bottom: 10px;
            margin-bottom: 15px;
        }

        .close-btn {
            background: none;
            border: none;
            color: var(--term-green);
            font-family: var(--font-stack);
            cursor: pointer;
            font-size: 1.2rem;
        }

        /* --- APP SPECIFIC --- */
        .grid-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 15px;
        }

        .app-card {
            border: 1px solid var(--term-dim);
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .app-card:hover {
            background: var(--term-dim);
            color: #000;
        }

        .music-visualizer {
            display: flex;
            justify-content: center;
            align-items: flex-end;
            height: 100px;
            gap: 5px;
        }

        .bar {
            width: 10px;
            background: var(--term-green);
            animation: bounce 1s infinite ease-in-out;
        }
        
        .bar:nth-child(2) { animation-delay: 0.1s; }
        .bar:nth-child(3) { animation-delay: 0.2s; }
        .bar:nth-child(4) { animation-delay: 0.3s; }
        .bar:nth-child(5) { animation-delay: 0.4s; }

        @keyframes bounce {
            0%, 100% { height: 10%; }
            50% { height: 100%; }
        }

        /* --- MOBILE TWEAKS --- */
        @media (max-width: 600px) {
            header { flex-direction: column; align-items: flex-start; gap: 10px; }
            .stats-bar { width: 100%; justify-content: space-between; }
        }
    </style>
</head>
<body>

<div class="crt-container">
    <div class="scanlines"></div>
    <div class="crt-flicker"></div>

    <div id="app">
        <header class="crt-glow">
            <div class="brand">TermOS LT üåå</div>
            <div class="stats-bar">
                <div class="stat-item" id="stat-room">üìç LOBBY</div>
                <div class="stat-item" id="stat-lvl">LVL: 1</div>
                <div class="stat-item" id="stat-xp">XP: 0</div>
                <div class="stat-item" id="stat-net">üåê ONLINE</div>
            </div>
        </header>

        <main id="terminal-output">
            <!-- Logs go here -->
        </main>

        <section id="input-area">
            <span class="prompt">guest@termos:~$</span>
            <input type="text" id="cmd-input" autocomplete="off" spellcheck="false" autofocus>
        </section>
    </div>

    <!-- MODALS -->
    <div id="modal-overlay" class="modal">
        <div class="modal-header">
            <span id="modal-title">SYSTEM MESSAGE</span>
            <button class="close-btn" onclick="closeModal()">[X]</button>
        </div>
        <div id="modal-content"></div>
    </div>
</div>

<script>
    /**
     * TermOS LT - Core Logic
     * Handles State, Gamification, AI Simulation, and DOM Manipulation
     */

    // --- STATE MANAGEMENT ---
    const STATE = {
        user: {
            username: 'Guest_' + Math.floor(Math.random() * 9999),
            level: 1,
            xp: 0,
            xpToNext: 100,
            room: 'LOBBY',
            avatar: 'newbie',
            joinedAt: new Date().toISOString()
        },
        rooms: {
            'LOBBY': { name: 'üåå Main Hub', desc: 'Central nexus of the multiverse.' },
            'LIBRARY': { name: 'üìö Library', desc: 'Knowledge repository with AI Librarian.' },
            'WORKSHOP': { name: 'üõ†Ô∏è Workshop', desc: 'Code factory with AI Engineer.' },
            'LOUNGE': { name: 'üé≠ Lounge', desc: 'Entertainment and games.' }
        },
        plugins: [],
        isVoiceActive: false
    };

    // --- AVATARS ---
    const AVATARS = {
        'newbie': `   (o.o)   `,
        'hacker': `  /\\_/\\  \n ( o.o ) \n  > ^ <`,
        'wizard': `    /\\    \n   /  \\   \n   \\__/   \n   o_o`,
        'ninja': `   ‚ó¢‚ó§   \n  o_o   \n  /|\\   \n  / \\`
    };

    // --- DOM ELEMENTS ---
    const terminal = document.getElementById('terminal-output');
    const input = document.getElementById('cmd-input');
    const modal = document.getElementById('modal-overlay');
    const modalTitle = document.getElementById('modal-title');
    const modalContent = document.getElementById('modal-content');
    
    // Stats elements
    const elRoom = document.getElementById('stat-room');
    const elLvl = document.getElementById('stat-lvl');
    const elXp = document.getElementById('stat-xp');

    // --- INITIALIZATION ---
    window.onload = () => {
        loadState();
        bootSequence();
        input.focus();
        
        // Global event listeners
        input.addEventListener('keydown', handleInput);
        document.addEventListener('click', () => input.focus());
    };

    function bootSequence() {
        const logs = [
            "Initializing TermOS Kernel v4.2.0...",
            "Loading Vector Database...",
            "Connecting to Multiverse Relay...",
            "Mounting Plugin Docker Container...",
            "System Ready."
        ];

        let delay = 0;
        logs.forEach((log, index) => {
            setTimeout(() => {
                printLog(log, 'system');
                if(index === logs.length - 1) {
                    printLog(`Welcome back, ${STATE.user.username}. Type /help for commands.`, 'ai');
                    updateStatsUI();
                }
            }, delay);
            delay += 600;
        });
    }

    // --- CORE TERMINAL FUNCTIONS ---

    function handleInput(e) {
        if (e.key === 'Enter') {
            const cmd = input.value.trim();
            input.value = '';
            
            if (cmd) {
                printLog(`${cmd}`, 'user', true); // true = show avatar
                processCommand(cmd);
                addXP(1); // XP for chatting
            }
        }
    }

    function printLog(text, type = 'system', showAvatar = false) {
        const div = document.createElement('div');
        div.className = `log-entry ${type} crt-glow`;
        
        const time = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        
        let content = `<span class="timestamp">[${time}]</span>`;
        
        if (showAvatar) {
            const art = AVATARS[STATE.user.avatar] || AVATARS['newbie'];
            content += `<span class="avatar-ascii">${art}</span> `;
        }

        content += text;
        div.innerHTML = content;
        
        terminal.appendChild(div);
        scrollToBottom();
    }

    function scrollToBottom() {
        terminal.scrollTop = terminal.scrollHeight;
    }

    function closeModal() {
        modal.classList.remove('active');
        input.focus();
    }

    function showModal(title, htmlContent) {
        modalTitle.innerText = title;
        modalContent.innerHTML = htmlContent;
        modal.classList.add('active');
    }

    // --- COMMAND PROCESSOR ---

    function processCommand(raw) {
        const parts = raw.split(' ');
        const cmd = parts[0].toLowerCase();
        const args = parts.slice(1);

        switch(cmd) {
            case '/help':
                printLog(`
                AVAILABLE COMMANDS:
                -------------------
                /help     - Show this menu
                /clear    - Clear terminal
                /stats    - View detailed stats
                /avatar   - Change avatar (Lvl 3+)
                /room     - Travel to a new room
                /share    - Create invite link
                /apps     - Open application menu
                /voice    - Toggle Voice Interface (Sim)
                
                AI COMMANDS:
                -----------
                "Play music"
                "Tell me a joke"
                "Check system status"
                "Create a plugin"
                `, 'system');
                break;

            case '/clear':
                terminal.innerHTML = '';
                break;

            case '/stats':
                const progress = Math.floor((STATE.user.xp / STATE.user.xpToNext) * 100);
                printLog(`USER PROFILE: ${STATE.user.username}
LEVEL: ${STATE.user.level}
XP: ${STATE.user.xp} / ${STATE.user.xpToNext} [${progress}%]
ROOM: ${STATE.user.room}
AVATAR: ${STATE.user.avatar}`, 'system');
                break;

            case '/room':
                if (args.length === 0) {
                    printLog("Usage: /room [name]. Available: LOBBY, LIBRARY, WORKSHOP, LOUNGE", 'system');
                } else {
                    changeRoom(args[0].toUpperCase());
                }
                break;

            case '/share':
                const shareLink = `${window.location.origin}?room=${STATE.user.room}&ref=${STATE.user.username}`;
                showModal("üîó Share Multiverse Link", `
                    <p>Invite friends to <strong>${STATE.user.room}</strong>:</p>
                    <input type="text" value="${shareLink}" style="width:100%; background:#111; color:#0f0; border:1px solid #0f0; padding:5px;" readonly>
                    <br><br>
                    <button class="app-card" style="width:100%" onclick="addXP(25); closeModal()">(+25 XP) Link Copied!</button>
                `);
                break;

            case '/apps':
                openAppsMenu();
                break;
            
            case '/avatar':
                if (STATE.user.level < 3) {
                    printLog("Avatar customization unlocked at Level 3 (Hacker).", 'error');
                } else {
                    // Simplified avatar selection for demo
                    STATE.user.avatar = 'hacker';
                    printLog("Avatar updated to: HACKER", 'system');
                    saveState();
                }
                break;

            case '/voice':
                STATE.isVoiceActive = !STATE.isVoiceActive;
                if(STATE.isVoiceActive) {
                    printLog("Microphone Active. Listening... (Say 'Stop' to end)", 'system');
                    // Simulate voice input
                    setTimeout(() => aiResponse("Voice input detected: 'Play some jazz'"), 3000);
                } else {
                    printLog("Voice Interface deactivated.", 'system');
                }
                break;

            default:
                // If not a command, send to AI
                aiResponse(raw);
        }
    }

    // --- AI LOGIC (TERMAI) ---

    function aiResponse(userText) {
        // Typing effect delay
        const delay = 500 + Math.random() * 1000;
        
        setTimeout(() => {
            const lower = userText.toLowerCase();
            let response = "";
            let action = null;

            // Simple Keyword Matching for "Agentic" behavior
            if (lower.includes('hello') || lower.includes('hi')) {
                response = `Greetings, ${STATE.user.username}. Systems operational.`;
            } 
            else if (lower.includes('music') || lower.includes('play')) {
                response = "Initializing Audio Synthesizer... Playing: Cyberpunk Lo-Fi.";
                action = 'music';
            }
            else if (lower.includes('joke')) {
                response = "Why do Java developers wear glasses? Because they don't C#.";
            }
            else if (lower.includes('status') || lower.includes('diagnostic')) {
                response = `System Integrity: 98%. Memory: 128MB/Free. Connection: Secure. XP: ${STATE.user.xp}.`;
            }
            else if (lower.includes('plugin') || lower.includes('code')) {
                response = "Accessing Docker Container... Downloading dependencies.";
                action = 'code';
            }
            else if (lower.includes('room')) {
                response = "You can change rooms using the /room command.";
            }
            else {
                response = `I processed "${userText}". Vector database updated. How else can I assist?`;
            }

            printLog(response, 'ai');
            
            // Execute "Agent Actions"
            if (action === 'music') {
                showModal("üéµ Music Player", `
                    <div style="text-align:center">
                        <h3>Cyberpunk Lo-Fi</h3>
                        <div class="music-visualizer">
                            <div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div>
                        </div>
                        <p style="margin-top:10px">[ Playing... ]</p>
                    </div>
                `);
                addXP(5);
            } else if (action === 'code') {
                showModal("üê≥ Plugin Editor", `
                    <textarea style="width:100%; height:150px; background:#000; color:#0f0; font-family:monospace; border:1px solid #0f0;">
def on_trigger(data):
    print("Plugin executed!")
    return {"status": "success"}</textarea>
                    <br><br>
                    <button class="app-card" onclick="addXP(50); closeModal()">Compile & Run (Docker)</button>
                `);
            }

        }, delay);
    }

    // --- APPS SYSTEM ---

    function openAppsMenu() {
        const appsHtml = `
            <div class="grid-container">
                <div class="app-card" onclick="launchApp('music')">
                    <div>üéµ</div>
                    <div>Audio</div>
                </div>
                <div class="app-card" onclick="launchApp('code')">
                    <div>üíª</div>
                    <div>IDE</div>
                </div>
                <div class="app-card" onclick="launchApp('game')">
                    <div>üéÆ</div>
                    <div>Game</div>
                </div>
                <div class="app-card" onclick="launchApp('files')">
                    <div>üìÇ</div>
                    <div>Files</div>
                </div>
            </div>
        `;
        showModal("üîå Installed Apps", appsHtml);
    }

    function launchApp(type) {
        closeModal();
        addXP(10);
        if (type === 'game') {
            showModal("üéÆ Space Invaders", `
                <div style="text-align:center; padding:20px;">
                    <p>GAME LOADING...</p>
                    <p>Use Arrow Keys to move</p>
                    <canvas id="game-canvas" width="200" height="100" style="border:1px solid #0f0; background:#000; display:block; margin:0 auto;"></canvas>
                    <script>
                        // Micro game script for demo
                        const c = document.getElementById('game-canvas');
                        const ctx = c.getContext('2d');
                        let x = 100;
                        function loop() {
                            ctx.clearRect(0,0,200,100);
                            ctx.fillStyle = '#0f0';
                            ctx.fillRect(x, 80, 10, 10);
                            x = (x + 2) % 200;
                            requestAnimationFrame(loop);
                        }
                        loop();
                    <\/script>
                </div>
            `);
        } else {
            printLog(`Launching ${type.toUpperCase()} application...`, 'system');
        }
    }

    // --- GAMIFICATION ---

    function changeRoom(roomName) {
        if (STATE.rooms[roomName]) {
            STATE.user.room = roomName;
            printLog(`Travelling to ${STATE.rooms[roomName].name}...`, 'system');
            setTimeout(() => {
                printLog(`Arrived at ${roomName}. ${STATE.rooms[roomName].desc}`, 'system');
                updateStatsUI();
                // Simulate AI personality change
                const greetings = {
                    'LIBRARY': "Shh... Welcome to the archive.",
                    'WORKSHOP': "Safety goggles on. Let's build.",
                    'LOUNGE': "Hey! Relax and have fun."
                };
                if(greetings[roomName]) printLog(greetings[roomName], 'ai');
            }, 800);
            saveState();
        } else {
            printLog("Error: Room not found in multiverse.", 'error');
        }
    }

    function addXP(amount) {
        STATE.user.xp += amount;
        
        // Level Up Logic
        if (STATE.user.xp >= STATE.user.xpToNext) {
            STATE.user.level++;
            STATE.user.xp -= STATE.user.xpToNext;
            STATE.user.xpToNext = Math.floor(STATE.user.xpToNext * 1.5);
            
            printLog(`*** LEVEL UP! You are now Level ${STATE.user.level} ***`, 'system');
            
            // Unlock Avatar at level 3
            if (STATE.user.level === 3) {
                STATE.user.avatar = 'hacker';
                printLog(`ACHIEVEMENT: Hacker Avatar Unlocked!`, 'ai');
            }
        }
        
        updateStatsUI();
        saveState();
    }

    function updateStatsUI() {
        elRoom.innerText = `üìç ${STATE.user.room}`;
        elLvl.innerText = `LVL: ${STATE.user.level}`;
        elXp.innerText = `XP: ${STATE.user.xp}`;
    }

    // --- PERSISTENCE ---

    function saveState() {
        localStorage.setItem('termos_state', JSON.stringify(STATE.user));
    }

    function loadState() {
        const saved = localStorage.getItem('termos_state');
        if (saved) {
            const parsed = JSON.parse(saved);
            // Merge saved state to prevent breaking if new fields added
            STATE.user = { ...STATE.user, ...parsed };
        }
    }

</script>
</body>
</html>
